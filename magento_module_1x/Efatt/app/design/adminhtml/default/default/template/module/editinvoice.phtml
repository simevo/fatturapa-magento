<?php 
$fId  		= Mage::registry('efatt-invoice-id');
$lUrl 		= "*/sales_invoice/viewinvoicespage/invoice_id/" . $fId; 
$mUrl 		= Mage::helper('adminhtml')->getUrl($lUrl);
$fKey 		= Mage::getSingleton('core/session')->getFormKey(); 
$config   	= Mage::registry('efatt-config'); 
$cc   		= Mage::registry('efatt-cessionario-committente');
$order      = Mage::registry('efatt-order');
$items      = Mage::registry('efatt-items');

?>

[item_id] => 5
            [order_id] => 5
            [parent_item_id] => 
            [quote_item_id] => 9
            [store_id] => 1
            [created_at] => 2018-08-02 12:48:15
            [updated_at] => 2018-08-02 12:49:05
            [product_id] => 2
            [product_type] => simple
            [product_options] => a:1:{s:15:"info_buyRequest";a:5:{s:4:"uenc";s:92:"aHR0cDovLzgwLjIxMS4xNDIuMTM3L21hZ2VudG8xOS9pbmRleC5waHAvbWFyYy1qYWNvYnMtbWFyYy1pY29uLmh0bWw,";s:7:"product";s:1:"2";s:8:"form_key";s:16:"9WfniCvyAAi5lv0I";s:15:"related_product";s:0:"";s:3:"qty";s:1:"3";}}
            [weight] => 0.1600
            [is_virtual] => 0
            [sku] => m-j
            [name] => MARC JACOBS MARC ICON
            [description] => 
            [applied_rule_ids] => 
            [additional_data] => 
            [free_shipping] => 0
            [is_qty_decimal] => 0
            [no_discount] => 0
            [qty_backordered] => 
            [qty_canceled] => 0.0000
            [qty_invoiced] => 3.0000
            [qty_ordered] => 3.0000
            [qty_refunded] => 0.0000
            [qty_shipped] => 0.0000
            [base_cost] => 
            [price] => 100.0000
            [base_price] => 100.0000
            [original_price] => 100.0000
            [base_original_price] => 100.0000
            [tax_percent] => 0.0000
            [tax_amount] => 0.0000
            [base_tax_amount] => 0.0000
            [tax_invoiced] => 0.0000
            [base_tax_invoiced] => 0.0000
            [discount_percent] => 0.0000
            [discount_amount] => 0.0000
            [base_discount_amount] => 0.0000
            [discount_invoiced] => 0.0000
            [base_discount_invoiced] => 0.0000
            [amount_refunded] => 0.0000
            [base_amount_refunded] => 0.0000
            [row_total] => 300.0000
            [base_row_total] => 300.0000
            [row_invoiced] => 300.0000
            [base_row_invoiced] => 300.0000
            [row_weight] => 0.4800
            [base_tax_before_discount] => 
            [tax_before_discount] => 
            [ext_order_item_id] => 
            [locked_do_invoice] => 
            [locked_do_ship] => 
            [price_incl_tax] => 100.0000
            [base_price_incl_tax] => 100.0000
            [row_total_incl_tax] => 300.0000
            [base_row_total_incl_tax] => 300.0000
            [hidden_tax_amount] => 0.0000
            [base_hidden_tax_amount] => 0.0000
            [hidden_tax_invoiced] => 0.0000
            [base_hidden_tax_invoiced] => 0.0000
            [hidden_tax_refunded] => 
            [base_hidden_tax_refunded] => 
            [is_nominal] => 0
            [tax_canceled] => 
            [hidden_tax_canceled] => 
            [tax_refunded] => 
            [base_tax_refunded] => 
            [discount_refunded] => 
            [base_discount_refunded] => 
            [gift_message_id] => 
            [gift_message_available] => 0
            [base_weee_tax_applied_amount] => 0.0000
            [base_weee_tax_applied_row_amnt] => 0.0000
            [base_weee_tax_applied_row_amount] => 0.0000
            [weee_tax_applied_amount] => 0.0000
            [weee_tax_applied_row_amount] => 0.0000
            [weee_tax_applied] => a:0:{}
            [weee_tax_disposition] => 0.0000
            [weee_tax_row_disposition] => 0.0000
            [base_weee_tax_disposition] => 0.0000
            [base_weee_tax_row_disposition] => 0.0000

<?php
// TODO: impostare questi tre valori server-side:
// 1. numero di elementi nel vettore FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo
$numeroLinee = count($items);
// 2. numero di elementi nel vettore FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee
$numeroRiepiloghi = 10;
// 3. JSON della fattura, serializzato a stringa per inizializzazione del form; può essere incompleto !
$data = '
{
    "FatturaElettronica": {
      "versione": "",
      "FatturaElettronicaHeader": {
        "DatiTrasmissione": {
          "IdTrasmittente": {
            "IdPaese": "' . $config['CedentePrestatore_DatiAnagrafici_IdFiscaleIVA']['IdPaese'] . '",
            "IdCodice": "' . $config['CedentePrestatore_DatiAnagrafici_IdFiscaleIVA']['IdCodice'] . '"
            },
          "ProgressivoInvio": "",
          "FormatoTrasmissione": "",
          "CodiceDestinatario": ""
        },
        "CedentePrestatore": {
          "DatiAnagrafici": {
            "IdFiscaleIVA": {
              "IdPaese": "' . $config['CedentePrestatore_DatiAnagrafici_IdFiscaleIVA']['IdPaese'] . '",
              "IdCodice": "' . $config['CedentePrestatore_DatiAnagrafici_IdFiscaleIVA']['IdCodice'] . '"
            },
            "Anagrafica": {
              "Denominazione": "' . $config['CedentePrestatore_DatiAnagrafici_Anagrafica']['Denominazione'] . '"
            },
            "RegimeFiscale": "' . $config['CedentePrestatore_DatiAnagrafici']['RegimeFiscale'] . '"
          },
          "Sede": {
            "Indirizzo": "' . $config['CedentePrestatore_Sede']['Indirizzo'] . '",
            "CAP": "' . $config['CedentePrestatore_Sede']['CAP'] . '",
            "Comune": "' . $config['CedentePrestatore_Sede']['Comune'] . '",
            "Provincia": "' . $config['CedentePrestatore_Sede']['Provincia'] . '",
            "Nazione": "' . $config['CedentePrestatore_Sede']['Nazione'] . '"
          }
        },
        "CessionarioCommittente": {
          "DatiAnagrafici": {
            "CodiceFiscale": "",
              "Anagrafica": {
                "Denominazione": "' . $cc['company'] . '"
              }
          },
          "Sede": {
            "Indirizzo": "' . $cc['street'] . '",
            "CAP": "' . $cc['postcode'] . '",
            "Comune": "' . $cc['city'] . '",
            "Provincia": "' . $cc['region'] . '",
            "Nazione": "' . $cc['country_id'] . '"
          }
        }
      },
      "FatturaElettronicaBody": [
        {
          "DatiGenerali": {
            "DatiGeneraliDocumento": {
              "TipoDocumento": "",
              "Divisa": "",
              "Data": "",
              "Numero": "",
              "Causale": [
                "",
                ""
              ]
            }
          },
          "DatiBeniServizi": {
            "DettaglioLinee": [';

$ic = 1;
foreach ($items as $item) {

        $data .= '{
                "NumeroLinea": "' . $ic . '",
                "Descrizione": "' . $item->name .'",
                "Quantita": "' . $item->qty_ordered . '",
                "PrezzoUnitario": "' . $item->original_price . '",
                "PrezzoTotale": "' . $item->row_total . '",
                "AliquotaIVA": "' . $item->tax_percent .'"
              },';

        $ic++;
}

        $data .= '],
            "DatiRiepilogo": [';

for ($j = 0; $j <= $numeroRiepiloghi; $j++):

        $data .= '{
                "AliquotaIVA": "",
                "ImponibileImporto": "",
                "Imposta": "",
                "EsigibilitaIVA": ""
              },';
endfor;

$data .= ' ]
          }
        }
      ]
    }
}
';
?>

<div id="page:main-container">

<form method="post" action='<?php echo $mUrl; ?>'>

<div class="content-header">
    <table cellspacing="0">
        <tbody><tr>
            <td style="width:50%;"><h3 class="icon-head head-sales-invoice"><?php echo "Fattura " . $fId ?> </h3></td>
            <td class="form-buttons"><button  type="submit" class="scalable save" style=""><span><span><span>Genera Fattura Elettronica</span></span></span></button></td>
        </tr>
    </tbody></table>
</div>


<input name="form_key" type="hidden" value='<?php echo $fKey ?>' />

<!-- outside #fattura to avoid JSON circularity -->
<textarea id="json" name="json" rows="10" cols="50"></textarea>
<textarea id="xml" name="xml" rows="10" cols="50"></textarea>
<textarea id="result" name="result" rows="10" cols="50"></textarea>

<div id="fattura" class="box">

<button type="button" v-on:click="generateJson();">Genera JSON</button>
<button type="button" v-on:click="generateXml();">Genera XML</button>
<button type="button" v-on:click="validateJson();">Valida JSON</button> 

<!-- code below generated with tweaked json-schema-form-php -->
<div class="section-object">
    <fieldset class="config collapseable" id="">
        <div>
            <div class="section-object">
                <fieldset class="config collapseable" id="FatturaElettronica">
                    <legend>Fattura Elettronica Italiana</legend>
                    <div>
                        <div>
                            <label for="FatturaElettronica-versione">Versione documento</label>
                            <input type="string" v-model="FatturaElettronica.versione" id="FatturaElettronica-versione">
                            <p class="note">
                                <span>FPR12: Fattura tra Privati, FPA12: Fattura verso Pubblica Amministrazione</span>
                            </p>
                        </div>

                    </div>
                    <div>
                        <div class="section-object">
                            <div class="entry-edit-head collapseable">
                                <a id="FatturaElettronica-FatturaElettronicaHeader" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.visible = !FatturaElettronica.FatturaElettronicaHeader.visible">Intestazione della Fattura Elettronica</a>
                            </div>
                            <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.visible" id="FatturaElettronica-FatturaElettronicaHeader">
                                <legend>Intestazione della Fattura Elettronica</legend>
                                <div>
                                    <div class="section-object">
                                        <div class="entry-edit-head collapseable">
                                            <a id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.visible = !FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.visible">Dati per il recapito del documento elettronico</a>
                                        </div>
                                        <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.visible" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione">
                                            <legend>Dati per il recapito del documento elettronico</legend>
                                            <div>
                                                <div class="section-object">
                                                    <div class="entry-edit-head collapseable">
                                                        <a id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-IdTrasmittente" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.IdTrasmittente.visible = !FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.IdTrasmittente.visible">Identificativo fiscale del soggetto trasmittente</a>
                                                    </div>
                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.IdTrasmittente.visible" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-IdTrasmittente">
                                                        <legend>Identificativo fiscale del soggetto trasmittente</legend>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-IdTrasmittente-IdPaese">Codice della nazione assegnante l’identificativo fiscale al soggetto trasmittente</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.IdTrasmittente.IdPaese" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-IdTrasmittente-IdPaese">
                                                                <p class="note">
                                                                    <span>Espressa secondo lo standard ISO 3166-1 alpha-2 code (https://it.wikipedia.org/wiki/ISO_3166-1_alpha-2), es: Italia: IT, Francia: FR, Svizzera: CH, San Marino: SM, Città del Vaticano: VA, Austria: AT, Slovenia: SI</span>
                                                                </p>
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-IdTrasmittente-IdCodice">Numero di identificazione fiscale del soggetto trasmittente (per i soggetti stabiliti nel territorio dello Stato Italiano corrisponde al Codice Fiscale; per i non residenti si fa riferimento all’identificativo fiscale assegnato dall’autorità del paese di residenza)</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.IdTrasmittente.IdCodice" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-IdTrasmittente-IdCodice">
                                                            </div>

                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                            <div>
                                                <div>
                                                    <label for="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-ProgressivoInvio">Progressivo che il soggetto trasmittente attribuisce al file che inoltra al Sistema di Interscambio per una propria finalità di identificazione univoca</label>
                                                    <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.ProgressivoInvio" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-ProgressivoInvio">
                                                </div>

                                            </div>
                                            <div>
                                                <div>
                                                    <label for="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-FormatoTrasmissione">Codice identificativo del tipo di trasmissione che si sta effettuando e del relativo formato</label>
                                                    <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.FormatoTrasmissione" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-FormatoTrasmissione">
                                                </div>

                                            </div>
                                            <div>
                                                <div>
                                                    <label for="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-CodiceDestinatario">Identifica il soggetto al quale è destinata la fattura</label>
                                                    <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.DatiTrasmissione.CodiceDestinatario" id="FatturaElettronica-FatturaElettronicaHeader-DatiTrasmissione-CodiceDestinatario">
                                                    <p class="note">
                                                        <span>Per PA: Codice Ufficio (6 caratteri, vedi https://www.indicepa.gov.it/). Per fatturazione verso privati, codice del canale di ricezione accreditato nel  Sistema di Interscambio (7 caratteri) oppure ‘0000000’ se riceve tramite PEC</span>
                                                    </p>
                                                </div>

                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div>
                                    <div class="section-object">
                                        <div class="entry-edit-head collapseable">
                                            <a id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.visible = !FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.visible">Dati del Cedente / Prestatore del bene / servizio</a>
                                        </div>
                                        <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.visible" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore">
                                            <legend>Dati del Cedente / Prestatore del bene / servizio</legend>
                                            <div>
                                                <div class="section-object">
                                                    <div class="entry-edit-head collapseable">
                                                        <a id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.visible = !FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.visible">Dati anagrafici del cedente/prestatore</a>
                                                    </div>
                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.visible" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici">
                                                        <legend>Dati anagrafici del cedente/prestatore</legend>
                                                        <div>
                                                            <div class="section-object">
                                                                <div class="entry-edit-head collapseable">
                                                                    <a id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-IdFiscaleIVA" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.IdFiscaleIVA.visible = !FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.IdFiscaleIVA.visible">Dati identificativi ai fini IVA del soggetto cedente/prestatore</a>
                                                                </div>
                                                                <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.IdFiscaleIVA.visible" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-IdFiscaleIVA">
                                                                    <legend>Dati identificativi ai fini IVA del soggetto cedente/prestatore</legend>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-IdFiscaleIVA-IdPaese">Codice del paese assegnante l’identificativo fiscale al soggetto cedente/prestatore</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.IdFiscaleIVA.IdPaese" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-IdFiscaleIVA-IdPaese">
                                                                            <p class="note">
                                                                                <span>Sigla della nazione espressa secondo lo standard ISO 3166-1 alpha-2 code (https://it.wikipedia.org/wiki/ISO_3166-1_alpha-2), es: Italia: IT, Francia: FR, Svizzera: CH, San Marino: SM, Città del Vaticano: VA, Austria: AT, Slovenia: SI</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-IdFiscaleIVA-IdCodice">Numero di identificazione fiscale del soggetto cedente/prestatore (per i soggetti stabiliti nel territorio dello Stato Italiano corrisponde al Codice Fiscale; per i non residenti si fa riferimento all’identificativo fiscale assegnato dall’autorità del paese di residenza)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.IdFiscaleIVA.IdCodice" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-IdFiscaleIVA-IdCodice">
                                                                        </div>

                                                                    </div>
                                                                </fieldset>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div class="section-object">
                                                                <div class="entry-edit-head collapseable">
                                                                    <a id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.Anagrafica.visible = !FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.Anagrafica.visible">Anagrafica</a>
                                                                </div>
                                                                <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.Anagrafica.visible" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica">
                                                                    <legend>Anagrafica</legend>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica-Denominazione">Ditta, denominazione o ragione sociale del cedente/prestatore (compilare nei casi di persona non fisica)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.Anagrafica.Denominazione" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica-Denominazione">
                                                                            <p class="note">
                                                                                <span>Questo campo è in alternativa ai campi Nome e Cognome</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica-Nome">Nome del cedente/prestatore (compilare nei casi di persona fisica)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.Anagrafica.Nome" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica-Nome">
                                                                            <p class="note">
                                                                                <span>Questo campo va compilato insieme al Cognome ed è in alternativa al campo Denominazione</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica-Cognome">Cognome del cedente/prestatore (compilare nei casi di persona fisica)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.Anagrafica.Cognome" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-Anagrafica-Cognome">
                                                                            <p class="note">
                                                                                <span>Questo campo va compilato insieme al Nome ed è in alternativa al campo Denominazione</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                </fieldset>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-RegimeFiscale">Regime fiscale del cedente/prestatore</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.DatiAnagrafici.RegimeFiscale" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-DatiAnagrafici-RegimeFiscale">
                                                                <p class="note">
                                                                    <span>RF01: Regime ordinario; RF02: Regime dei contribuenti minimi; RF03: Regime delle nuove iniziative produttive; RF04: Agricoltura e attività connesse e pesca; RF05: Vendita sali e tabacchi; RF06: Commercio dei fiammiferi; RF07: Editoria; RF08: Gestione di servizi di telefonia pubblica; RF09: Rivendita di documenti di trasporto pubblico e di sosta; RF10: Intrattenimenti, giochi e altre attività; RF11: Agenzie di viaggi e turismo; RF12: Agriturismo; RF13: Vendite a domicilio; RF14: Rivendita di beni usati, di oggetti d&#039;arte, d&#039;antiquariato o da collezione; RF15: Agenzie di vendite all&#039;asta di oggetti d&#039;arte, antiquariato o da collezione; RF16: IVA per cassa P.A.; RF17: IVA per cassa; RF19: Regime forfettario; RF18: Altro</span>
                                                                </p>
                                                            </div>

                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="section-object">
                                                    <div class="entry-edit-head collapseable">
                                                        <a id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.visible = !FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.visible">Sede legale per le società e del domicilio fiscale per le ditte individuali e i lavoratori autonomi</a>
                                                    </div>
                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.visible" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede">
                                                        <legend>Sede legale per le società e del domicilio fiscale per le ditte individuali e i lavoratori autonomi</legend>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-Indirizzo">Indirizzo del cedente/prestatore: via / piazza / ... nome e (opzionale) numero civico</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.Indirizzo" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-Indirizzo">
                                                                <p class="note">
                                                                    <span>Il numero civico può anche essere indicato separatamente nel campo apposito</span>
                                                                </p>
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-CAP">Codice di Avviamento Postale</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.CAP" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-CAP">
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-Comune">Comune</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.Comune" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-Comune">
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-Nazione">Codice della nazione</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CedentePrestatore.Sede.Nazione" id="FatturaElettronica-FatturaElettronicaHeader-CedentePrestatore-Sede-Nazione">
                                                                <p class="note">
                                                                    <span>Espressa secondo lo standard ISO 3166-1 alpha-2 code (https://it.wikipedia.org/wiki/ISO_3166-1_alpha-2), es: Italia: IT, Francia: FR, Svizzera: CH, San Marino: SM, Città del Vaticano: VA, Austria: AT, Slovenia: SI</span>
                                                                </p>
                                                            </div>

                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div>
                                    <div class="section-object">
                                        <div class="entry-edit-head collapseable">
                                            <a id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.visible = !FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.visible">Dati del Cessionario / Committente</a>
                                        </div>
                                        <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.visible" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente">
                                            <legend>Dati del Cessionario / Committente</legend>
                                            <div>
                                                <div class="section-object">
                                                    <div class="entry-edit-head collapseable">
                                                        <a id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.visible = !FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.visible">Dati anagrafici del cessionario/committente</a>
                                                    </div>
                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.visible" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici">
                                                        <legend>Dati anagrafici del cessionario/committente</legend>
                                                        <div>
                                                            <div class="section-object">
                                                                <div class="entry-edit-head collapseable">
                                                                    <a id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.Anagrafica.visible = !FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.Anagrafica.visible">Anagrafica</a>
                                                                </div>
                                                                <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.Anagrafica.visible" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica">
                                                                    <legend>Anagrafica</legend>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica-Denominazione">Ditta, denominazione o ragione sociale del cessionario/committente (compilare nei casi di persona non fisica)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.Anagrafica.Denominazione" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica-Denominazione">
                                                                            <p class="note">
                                                                                <span>Questo campo è in alternativa ai campi Nome e Cognome</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica-Nome">Nome del cessionario/committente (compilare nei casi di persona fisica)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.Anagrafica.Nome" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica-Nome">
                                                                            <p class="note">
                                                                                <span>Questo campo va compilato insieme al Cognome ed è in alternativa al campo Denominazione</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                    <div>
                                                                        <div>
                                                                            <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica-Cognome">Cognome del cessionario/committente (compilare nei casi di persona fisica)</label>
                                                                            <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.DatiAnagrafici.Anagrafica.Cognome" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-DatiAnagrafici-Anagrafica-Cognome">
                                                                            <p class="note">
                                                                                <span>Questo campo va compilato insieme al Nome ed è in alternativa al campo Denominazione</span>
                                                                            </p>
                                                                        </div>

                                                                    </div>
                                                                </fieldset>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="section-object">
                                                    <div class="entry-edit-head collapseable">
                                                        <a id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede" href="#" v-on:click="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.visible = !FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.visible">Sede</a>
                                                    </div>
                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.visible" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede">
                                                        <legend>Sede</legend>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-Indirizzo">Indirizzo del cessionario/committente: via / piazza / ... nome e (opzionale) numero civico</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.Indirizzo" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-Indirizzo">
                                                                <p class="note">
                                                                    <span>Il numero civico può anche essere indicato separatamente nel campo apposito</span>
                                                                </p>
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-CAP">Codice di Avviamento Postale</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.CAP" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-CAP">
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-Comune">Comune</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.Comune" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-Comune">
                                                            </div>

                                                        </div>
                                                        <div>
                                                            <div>
                                                                <label for="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-Nazione">Codice della nazione</label>
                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaHeader.CessionarioCommittente.Sede.Nazione" id="FatturaElettronica-FatturaElettronicaHeader-CessionarioCommittente-Sede-Nazione">
                                                                <p class="note">
                                                                    <span>Espresso secondo lo standard ISO 3166-1 alpha-2 code (https://it.wikipedia.org/wiki/ISO_3166-1_alpha-2), es: Italia: IT, Francia: FR, Svizzera: CH</span>
                                                                </p>
                                                            </div>

                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div>
                        <div class="section-array">
                            <fieldset>
                                <legend>Fatture elettroniche</legend>
                                <div class="section-object">
                                    <div class="entry-edit-head collapseable">
                                        <a id="FatturaElettronica-FatturaElettronicaBody-0" href="#">Fattura</a>
                                    </div>
                                    <fieldset class="config" id="FatturaElettronica-FatturaElettronicaBody-0">
                                        <legend>Fattura</legend>
                                        <div>
                                            <div class="section-object">
                                                <div class="entry-edit-head collapseable">
                                                    <a id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali" href="#" v-on:click="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.visible = !FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.visible">Dati Generali</a>
                                                </div>
                                                <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.visible" id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali">
                                                    <legend>Dati Generali</legend>
                                                    <div>
                                                        <div class="section-object">
                                                            <div class="entry-edit-head collapseable">
                                                                <a id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento" href="#" v-on:click="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.visible = !FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.visible">Dati Generali del documento</a>
                                                            </div>
                                                            <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.visible" id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento">
                                                                <legend>Dati Generali del documento</legend>
                                                                <div>
                                                                    <div>
                                                                        <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-TipoDocumento">Tipologia del documento oggetto della trasmissione</label>
                                                                        <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.TipoDocumento" id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-TipoDocumento">
                                                                        <p class="note">
                                                                            <span>TD01: Fattura, TD02: Acconto / anticipo su fattura, TD03: Acconto / anticipo su parcella, TD04: Nota di credito, TD05: Nota di debito, TD06: Parcella</span>
                                                                        </p>
                                                                    </div>

                                                                </div>
                                                                <div>
                                                                    <div>
                                                                        <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-Divisa">Valuta utilizzata per l&#039;indicazione degli importi</label>
                                                                        <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.Divisa" id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-Divisa">
                                                                        <p class="note">
                                                                            <span>Espresso secondo lo standard ISO 4217 alpha-3:2001 (https://it.wikipedia.org/wiki/ISO_4217#Codici_attivi), esempi: EUR, USD, CHF, GBP, CZK ...</span>
                                                                        </p>
                                                                    </div>

                                                                </div>
                                                                <div>
                                                                    <div>
                                                                        <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-Data">Data del documento</label>
                                                                        <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.Data" id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-Data">
                                                                        <p class="note">
                                                                            <span>Rappresentata secondo il formato ISO 8601:2004 (https://it.wikipedia.org/wiki/ISO_8601), con la seguente precisione: YYYY-MM-DD</span>
                                                                        </p>
                                                                    </div>

                                                                </div>
                                                                <div>
                                                                    <div>
                                                                        <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-Numero">Numero progressivo attribuito dal cedente/prestatore al documento</label>
                                                                        <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiGenerali.DatiGeneraliDocumento.Numero" id="FatturaElettronica-FatturaElettronicaBody-0-DatiGenerali-DatiGeneraliDocumento-Numero">
                                                                    </div>

                                                                </div>
                                                            </fieldset>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="section-object">
                                                <div class="entry-edit-head collapseable">
                                                    <a id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi" href="#" v-on:click="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.visible = !FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.visible">Dati dei Beni / Servizi</a>
                                                </div>
                                                <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.visible" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi">
                                                    <legend>Dati dei Beni / Servizi</legend>
                                                    <div>
                                                        <div class="section-array">
                                                            <fieldset>
                                                                <legend>Linee di dettaglio del bene/servizio</legend>
<?php 
for ($i = 0; $i <= $numeroLinee; $i++):
?>
                                                                <div class="section-object">
                                                                    <div class="entry-edit-head collapseable">
                                                                        <a id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>" v-on:click="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].visible = !FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].visible" href="#">Linea di dettaglio</a>
                                                                    </div>
                                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].visible" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>">
                                                                        <legend>Linea di dettaglio</legend>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-NumeroLinea">Numero identificativo della linea di dettaglio</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].NumeroLinea" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-NumeroLinea">
                                                                            </div>

                                                                        </div>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-Descrizione">Natura e qualità del bene/servizio oggetto della cessione/prestazione; può fare anche riferimento ad un precedente documento emesso a titolo di anticipo/acconto</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].Descrizione" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-Descrizione">
                                                                            </div>

                                                                        </div>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-PrezzoUnitario">Prezzo unitario del bene/servizio; nel caso di beni ceduti a titolo di sconto, premio o abbuono, l&#039;importo indicato rappresenta il &quot;valore normale&quot;</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].PrezzoUnitario" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-PrezzoUnitario">
                                                                            </div>

                                                                        </div>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-PrezzoTotale">Importo totale del bene/servizio al netto dell&#039;eventuale sconto</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].PrezzoTotale" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-PrezzoTotale">
                                                                            </div>

                                                                        </div>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-AliquotaIVA">Aliquota IVA applicata alla cessione/prestazione; nel caso di non applicabilità, il campo deve essere impostato a 0.00</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DettaglioLinee[<?php echo $i; ?>].AliquotaIVA" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DettaglioLinee-<?php echo $i; ?>-AliquotaIVA">
                                                                                <p class="note">
                                                                                    <span>Espressa in percentuale con due decimali separati dall&#039;intero con il carattere &#039;.&#039; (punto)</span>
                                                                                </p>
                                                                            </div>

                                                                        </div>
                                                                    </fieldset>
                                                                </div>
<?php 
endfor;
?>

                                                            </fieldset>
                                                        </div>

                                                    </div>
                                                    <div>
                                                        <div class="section-array">
                                                            <fieldset>
<?php 
for ($j = 0; $j <= $numeroRiepiloghi; $j++):
?>
                                                                <legend>Dati di riepilogo</legend>
                                                                <div class="section-object">
                                                                    <div class="entry-edit-head collapseable">
                                                                        <a id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>" href="#" v-on:click="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo[<?php echo $j; ?>].visible = !FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo[<?php echo $j; ?>].visible">Dati di riepilogo per aliquota</a>
                                                                    </div>
                                                                    <fieldset class="config" v-if="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo[<?php echo $j; ?>].visible" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>">
                                                                        <legend>Dati di riepilogo per aliquota</legend>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>-AliquotaIVA">Aliquota IVA applicata alla cessione/prestazione; nel caso di non applicabilità, il campo deve essere impostato a 0.00</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo[<?php echo $j; ?>].AliquotaIVA" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>-AliquotaIVA">
                                                                                <p class="note">
                                                                                    <span>Espressa in percentuale con due decimali separati dall&#039;intero con il carattere &#039;.&#039; (punto)</span>
                                                                                </p>
                                                                            </div>

                                                                        </div>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>-ImponibileImporto">Valore che rappresenta la base imponibile per le operazioni soggette ad IVA, oppure l’importo per le operazioni che non rientrano tra quelle &#039;imponibili&#039;</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo[<?php echo $j; ?>].ImponibileImporto" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>-ImponibileImporto">
                                                                            </div>

                                                                        </div>
                                                                        <div>
                                                                            <div>
                                                                                <label for="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>-Imposta">Imposta corrispondente all’applicazione dell’aliquota IVA sulla base imponibile</label>
                                                                                <input type="string" v-model="FatturaElettronica.FatturaElettronicaBody[0].DatiBeniServizi.DatiRiepilogo[<?php echo $j; ?>].Imposta" id="FatturaElettronica-FatturaElettronicaBody-0-DatiBeniServizi-DatiRiepilogo-<?php echo $j; ?>-Imposta">
                                                                            </div>

                                                                        </div>
                                                                    </fieldset>
                                                                </div>
<?php 
endfor;
?>

                                                            </fieldset>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </fieldset>
                        </div>

                    </div>
                </fieldset>
            </div>
        </div>
    </fieldset>
</div>
<!-- end code generated with tweaked json-schema-form-php -->

</div>

</form>
</div> <!-- /fattura -->


<script type="text/javascript">// <![CDATA[
// configuration for jshint
/* jshint browser: true, devel: true */
/* global Vue, Handlebars, jsonSchema */

"use strict";

function merge(target, source) {
  if (typeof target === 'object') {
    for (var key in target) {
      if ((key !== '__proto__') && (key in source)) {
        target[key] = merge(target[key], source[key]);
      }
    }
  } else if (typeof target !== 'function') {
    target = source;
  }
  return target;
}

// https://stackoverflow.com/a/31729267
function removeVisible(obj) {
  var prop;
  for (prop in obj) {
    if (prop === 'visible') {
      delete obj[prop];
    } else if (typeof obj[prop] === 'object') {
      removeVisible(obj[prop]);
    }
  }
}

var app = new Vue({
  el: '#fattura',
  data: {
    // empty data
    "FatturaElettronica": {
      "visible": true,
      "versione": "",
      "FatturaElettronicaHeader": {
        "visible": true,
        "DatiTrasmissione": {
          "visible": true,
          "IdTrasmittente": {
            "visible": true,
            "IdPaese": "",
            "IdCodice": ""
            },
          "ProgressivoInvio": "",
          "FormatoTrasmissione": "",
          "CodiceDestinatario": ""
        },
        "CedentePrestatore": {
          "visible": true,
          "DatiAnagrafici": {
            "visible": true,
            "IdFiscaleIVA": {
              "visible": true,
              "IdPaese": "",
              "IdCodice": ""
            },
            "Anagrafica": {
              "visible": true,
              "Denominazione": ""
            },
            "RegimeFiscale": ""
          },
          "Sede": {
            "visible": true,
            "Indirizzo": "",
            "CAP": "",
            "Comune": "",
            "Provincia": "",
            "Nazione": ""
          }
        },
        "CessionarioCommittente": {
          "visible": true,
          "DatiAnagrafici": {
            "visible": true,
            "CodiceFiscale": "",
              "Anagrafica": {
                "visible": true,
                "Denominazione": ""
              }
          },
          "Sede": {
            "visible": true,
            "Indirizzo": "",
            "CAP": "",
            "Comune": "",
            "Provincia": "",
            "Nazione": ""
          }
        }
      },
      "FatturaElettronicaBody": [
        {
          "DatiGenerali": {
            "visible": true,
            "DatiGeneraliDocumento": {
              "visible": true,
              "TipoDocumento": "",
              "Divisa": "",
              "Data": "",
              "Numero": "",
              "Causale": [
                "",
                ""
              ]
            }
          },
          "DatiBeniServizi": {
            "visible": true,
            "DettaglioLinee": [
<?php 
for ($i = 0; $i <= $numeroLinee; $i++):
?>
              {
                "visible": true,
                "NumeroLinea": "",
                "Descrizione": "",
                "Quantita": "",
                "PrezzoUnitario": "",
                "PrezzoTotale": "",
                "AliquotaIVA": ""
              },
<?php 
endfor;
?>
            ],
            "DatiRiepilogo": [
<?php 
for ($j = 0; $j <= $numeroRiepiloghi; $j++):
?>
              {
                "visible": true,
                "AliquotaIVA": "",
                "ImponibileImporto": "",
                "Imposta": "",
                "EsigibilitaIVA": ""
              },
<?php 
endfor;
?>
            ]
          }
        }
      ]
    }
  },
  mounted: function() {
    var self = this;
    var new_data = <?php echo $data; ?>;
    merge(self.FatturaElettronica, new_data.FatturaElettronica);
  },
  methods: {
    getInvoice: function() {
      var json = JSON.stringify(this.$data);
      var invoice = JSON.parse(json);
      removeVisible(invoice);
      return invoice;
    },
    validateJson: function() {
      var self = this;
      var request = new XMLHttpRequest();
      request.open("GET", "<?php echo Mage::getBaseUrl('js'); ?>/efatt/fatturaPA_1.2_schema.json");
      request.onload = function() {
        if (request.status == 200) {
          if (request.responseText) {
            var schema = JSON.parse(request.responseText);
            var invoice = self.getInvoice();
            var result = jsonSchema.validate(invoice, schema);
            document.getElementById("result").value = JSON.stringify(result);
          }
        }
      };
      request.send();
    },
    generateJson: function() {
      var invoice = this.getInvoice();
      var json = JSON.stringify(invoice);
      document.getElementById("json").value = json;
    },
    generateXml: function() {
      var self = this;
      var request = new XMLHttpRequest();
      request.open("GET", "<?php echo Mage::getBaseUrl('js'); ?>/efatt/fatturaPA_1.2.hbs");
      request.onload = function() {
        if (request.status == 200) {
          if (request.responseText) {
            var source = request.responseText;
            var template = Handlebars.compile(source);
            var context = self.getInvoice();
            var xml = template(context);
            document.getElementById("xml").value = xml;
          }
        }
      };
      request.send();
    },
  }
});

document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM fully loaded and parsed");
});

/*
Calendar.setup({
    inputField : 'DatiGenerali_DatiGeneraliDocumento_Data',
    ifFormat : '%Y-%m-%e',
    button : 'date_from_trig',
    align : 'Bl',
    singleClick : true
});

*/
// ]]></script>

  
